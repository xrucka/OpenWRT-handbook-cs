\subsection{Switch}
\label{net:switch}
V záložce \uv{Network $\rightarrow$ Switch} najdete nastavení vestavěného
hardwarového switche. Tento má tzv. logické porty, jejichž číslování nemusí
odpovídat číslování fyzickému. A mnohdy také neodpovídá. U některých zařízení
jsou LAN a WAN porty prezentovány jako oddělené hardwarové síťové karty
(kde switch je připojen k LAN), na jiných jsou obé jen jinak barevně rozlišené
porty na zádech routeru, všechny připojené do switche. Aby tato rozhraní v
systému vystupovala odděleně, je každému z nich nastavena oddělená \gls{vlan}.
\input{W8970B-switch}

Co je to \gls{vlan}? Virtual LAN - způsob značkování
paketů na fyzické lince, umožňující přenos více logických sítí po stejném
médiu. Aby \gls{vlan} fungovala, musí se při vysílání paketu přidat před
paket značka s číslem, do které \gls{vlan} paket patří. Příjemce
pak musí mít pro stejnou \gls{vlan} nastavenu stejnou síť. Protože ne vždy
je toto značkování (angl. tagged) žádoucí, je možné použít neznačkovaný režim
portu. To znamená, že při vysílání ven je značka odstraněna a naopak při
přijetí je značka doplněna (angl. untagged). Port může být veden jako neznačkovaný
pro nejvýše jednu VLAN.

Toto umožňuje realizovat jak WAN, tak LAN rozhraní jedním switchem. Logické
\gls{wan} rozhraní je tvořeno jednou \gls{vlan} (např. VLAN ID 2), kdežto
LAN jinou \gls{vlan} (např. VLAN ID 1). Porty, patřící do fyzické LAN jsou
pak neznačkované (untagged) pro \gls{vlan} 1 se zakázanou \gls{vlan} 2, porty
pro \gls{wan} pak naopak.

Některé routery mají hybridní zapojení síťového hardware -- \gls{wan} i
\gls{lan} jsou přivedeny do stejného switche, kde jsou realizovány pomocí \gls{vlan}.
Avšak namísto toho, aby byl tento switch dalším portem připojen k CPU, je k CPU
připojen hned dvěma porty. Jeden tento port pak patří do \gls{vlan} reprezentující
\gls{wan}, druhý pak plní stejnou úlohu pro \gls{lan}.

Pokud byste chtěli \gls{wan} port přemostit do \gls{lan}, pak si zkontrolujte
že není reprezentován jako \gls{vlan}. Přemostění dvou vlan pomocí bridge
by mohlo vyústit v chybnou konfiguraci routeru. V takovém případě raději přidejte
\gls{wan} port do stejné \gls{vlan}. Naopak, pokud budete chtít některý z LAN
portů použít pro WAN, přiřaďte mu (neznačkovanou) \gls{vlan} použitou pro WAN
port.

Ačkoliv \gls{openwrt} umožňuje mít odlišné VLAN ID a identifikátor pro síťové
rozhraní, je lepší mít tyto nastaveny na stejnou hodnotu -- odlišné nastavení
nemusí na řadě routerů fungovat. Na konkrétní \gls{vlan} se pak V konfiguraci
rozhraní odkážete přes jméno switche (zpravidla \uv{eth0}), doplněné tečkou
a číslem rozhraní (tedy \uv{eth0.1} pro LAN). Aby tato možnost fungovala, musí
být port CPU vždy označen za značkovaný pro každou \gls{vlan}.

Se změnami VLAN buďte opatrní, zvláště pokud zasahujete do připojení k procesoru.
V takovém případě doporučuji jednak použít externí úložiště, druhak nastavit
vše najednou pomocí příkazové řádky (nejlépe textovým editorem), vše si po sobě
několikrát opakovaně přečíst a teprve posléze nastavení aplikovat restartem.
